<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Academics | Faculty Dashboard</title>
  <link rel="stylesheet" href="/css/style.css">
</head>

<body class="dashboard-body">

<div class="layout">

  <aside class="sidebar">
    <div class="logo-icon">F</div>
    <a href="/faculty/">ğŸ  Dashboard</a>
    <a href="/faculty/students">ğŸ‘¨â€ğŸ“ Students</a>
    <a href="/faculty/academics">ğŸ“š Academics</a>
    <a href="/logout">ğŸšª Logout</a>
  </aside>

  <main class="dashboard">

    <section class="greeting">
      <h1>ğŸ“š Academics Management</h1>
      <p>Add assignments, schedule exams and view submissions</p>
    </section>

    <!-- ASSIGNMENTS SECTION -->
    <section class="main-grid">

      <div class="card">
        <h2>ğŸ“ Add New Assignment</h2>
        <div style="display:flex; flex-direction:column; gap:12px; margin-top:16px;">
          <input id="aTitle" placeholder="Title" style="padding:12px; border-radius:10px; border:1px solid var(--border);">
          <input id="aSubject" placeholder="Subject" style="padding:12px; border-radius:10px; border:1px solid var(--border);">
          <textarea id="aDesc" placeholder="Description (optional)" rows="3"
            style="padding:12px; border-radius:10px; border:1px solid var(--border); font-family:inherit; resize:vertical;"></textarea>
          <label style="color:var(--muted); font-size:13px;">Due Date</label>
          <input type="date" id="aDueDate" style="padding:12px; border-radius:10px; border:1px solid var(--border);">
          <button onclick="addAssignment()"
            style="padding:12px; border-radius:10px; border:none; background:linear-gradient(135deg,var(--primary),var(--secondary)); color:white; font-weight:700; cursor:pointer;">
            â• Add Assignment
          </button>
          <p id="aMsg" style="font-weight:600;"></p>
        </div>
      </div>

      <div class="card">
        <h2>ğŸ“‹ My Assignments</h2>
        <div id="assignmentList" style="display:flex; flex-direction:column; gap:10px; margin-top:16px; max-height:400px; overflow-y:auto;"></div>
      </div>

    </section>

    <!-- EXAMS SECTION -->
    <section class="main-grid">

      <div class="card">
        <h2>ğŸ§ª Schedule Exam</h2>
        <div style="display:flex; flex-direction:column; gap:12px; margin-top:16px;">
          <input id="eSubject" placeholder="Subject" style="padding:12px; border-radius:10px; border:1px solid var(--border);">
          <label style="color:var(--muted); font-size:13px;">Exam Date</label>
          <input type="date" id="eDate" style="padding:12px; border-radius:10px; border:1px solid var(--border);">
          <select id="eType" style="padding:12px; border-radius:10px; border:1px solid var(--border);">
            <option value="Regular">Regular</option>
            <option value="Mid-Term">Mid-Term</option>
            <option value="End-Term">End-Term</option>
            <option value="Practical">Practical</option>
            <option value="Viva">Viva</option>
          </select>
          <button onclick="addExam()"
            style="padding:12px; border-radius:10px; border:none; background:linear-gradient(135deg,var(--primary),var(--secondary)); color:white; font-weight:700; cursor:pointer;">
            â• Schedule Exam
          </button>
          <p id="eMsg" style="font-weight:600;"></p>
        </div>
      </div>

      <div class="card">
        <h2>ğŸ—“ï¸ Scheduled Exams</h2>
        <div id="examList" style="display:flex; flex-direction:column; gap:10px; margin-top:16px; max-height:400px; overflow-y:auto;"></div>
      </div>

    </section>

  </main>
</div>

<script>

document.addEventListener("DOMContentLoaded", () => {
  loadAssignments();
  loadExams();
});

function addAssignment() {
  const title = document.getElementById("aTitle").value;
  const subject = document.getElementById("aSubject").value;
  const description = document.getElementById("aDesc").value;
  const due_date = document.getElementById("aDueDate").value;
  const msg = document.getElementById("aMsg");

  if (!title || !due_date) {
    msg.style.color = "red"; msg.innerText = "Title and due date required"; return;
  }

  fetch("/faculty/assignment/add", {
    method: "POST", credentials: "include",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ title, subject, description, due_date })
  }).then(r => r.json()).then(d => {
    if (d.success) {
      msg.style.color = "green"; msg.innerText = "âœ… Assignment added!";
      document.getElementById("aTitle").value = "";
      document.getElementById("aSubject").value = "";
      document.getElementById("aDesc").value = "";
      document.getElementById("aDueDate").value = "";
      loadAssignments();
    } else {
      msg.style.color = "red"; msg.innerText = d.message || "Failed";
    }
  });
}

function loadAssignments() {
  fetch("/faculty/assignments/list", { credentials: "include" })
    .then(r => r.json())
    .then(rows => {
      const el = document.getElementById("assignmentList");
      if (!rows.length) { el.innerHTML = "<p style='color:var(--muted);'>No assignments yet</p>"; return; }
      el.innerHTML = rows.map(a => `
        <div style="padding:14px; border-radius:12px; background:var(--bg); border-left:4px solid var(--primary);">
          <strong>${a.title}</strong>
          <p style="font-size:13px; color:var(--muted); margin-top:4px;">${a.subject || "No subject"}</p>
          <p style="font-size:12px; color:var(--muted);">Due: ${a.due_date ? a.due_date.slice(0,10) : "â€”"}</p>
          ${a.description ? `<p style="font-size:13px; margin-top:6px; color:var(--text);">${a.description}</p>` : ""}
        </div>
      `).join("");
    });
}

function addExam() {
  const subject = document.getElementById("eSubject").value;
  const exam_date = document.getElementById("eDate").value;
  const exam_type = document.getElementById("eType").value;
  const msg = document.getElementById("eMsg");

  if (!subject || !exam_date) {
    msg.style.color = "red"; msg.innerText = "Subject and date required"; return;
  }

  fetch("/faculty/exam/add", {
    method: "POST", credentials: "include",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ subject, exam_date, exam_type })
  }).then(r => r.json()).then(d => {
    if (d.success) {
      msg.style.color = "green"; msg.innerText = "âœ… Exam scheduled!";
      document.getElementById("eSubject").value = "";
      document.getElementById("eDate").value = "";
      loadExams();
    } else {
      msg.style.color = "red"; msg.innerText = d.message || "Failed";
    }
  });
}

function loadExams() {
  fetch("/faculty/exams/list", { credentials: "include" })
    .then(r => r.json())
    .then(rows => {
      const el = document.getElementById("examList");
      if (!rows.length) { el.innerHTML = "<p style='color:var(--muted);'>No exams scheduled</p>"; return; }
      el.innerHTML = rows.map(e => `
        <div style="padding:14px; border-radius:12px; background:var(--bg); border-left:4px solid var(--secondary);">
          <strong>${e.subject}</strong>
          <p style="font-size:13px; color:var(--muted); margin-top:4px;">${e.exam_type || "Regular"}</p>
          <p style="font-size:12px; color:var(--muted);">Date: ${e.exam_date ? e.exam_date.slice(0,10) : "â€”"}</p>
        </div>
      `).join("");
    });
}

</script>

</body>
</html>